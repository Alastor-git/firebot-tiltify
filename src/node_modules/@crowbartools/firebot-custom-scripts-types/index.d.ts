import * as FS from "fs";
import * as Path from "path";
import ChildProcess from "child_process";
import Moment from "moment";

import { FirebotSettings } from "./settings";
import { CommandManager } from "./modules/command-manager";
import { CounterManager } from "./modules/counter-manager";
import { CurrencyDB } from "./modules/currency-db";
import { CurrencyManager } from "./modules/currency-manager";
import { CustomVariableManager } from "./modules/custom-variable-manager";
import { EffectManager } from "./modules/effect-manager";
import { EffectRunner } from "./modules/effect-runner";
import { Effects } from "./effects";
import { EventFilterManager } from "./modules/event-filter-manager";
import { EventFilterFactory } from "./modules/event-filter-factory";
import { EventManager } from "./modules/event-manager";
import { FirebotRolesManager } from "./modules/firebot-roles-manager";
import { FrontendCommunicator } from "./modules/frontend-communicator";
import { GameManager } from "./modules/game-manager";
import { HttpServerManager } from "./modules/http-server-manager";
import { Logger } from "./modules/logger";
import { QuotesManager } from "./modules/quotes-manager";
import { ReplaceVariableManager } from "./modules/replace-variable-manager";
import { ResourceTokenManager } from "./modules/resource-token-manager";
import { TwitchApi } from "./modules/twitch-api";
import { TwitchChat } from "./modules/twitch-chat";
import { UserDb } from "./modules/user-db";
import { Utils } from "./modules/utils";
import { ConditionManager } from "./modules/condition-manager";
import { RestrictionManager } from "./modules/restriction-manager";
import { IntegrationManager } from "./modules/integration-manager";
import { ReplaceVariableFactory } from "./modules/replace-variable-factory";
import { ParametersConfig } from "./modules/firebot-parameters";
import { NotificationManager } from "./modules/notification-manager";
import { UIExtensionManager } from "./modules/ui-extension-manager";
import { ReplaceVariable } from "./modules/replace-variable-manager";
import { EventFilter } from "./modules/event-filter-manager";
import { 
    UserAccount, 
    CustomScriptManifest, 
    ScriptModules, 
    ValidParamKeys, 
    RunRequestParameters, 
    RunRequest, 
    ScriptReturnObject 
} from "./"; 

export declare module '@crowbartools/firebot-custom-scripts-types' {
    export {
        type AccountIdDefinition,
        type AccountIdDetails,
        type IntegrationData,
        type IntegrationDefinition,
        type LinkData,
        IntegrationEvents,
        IntegrationController,
        type Integration,
        IntegrationManagerEvents,
        type IntegrationManager
    } from "./modules/integration-manager";
    export {
        type AuthDetails,
        type AuthProviderDefinition
    } from "./modules/auth-manager";
    export { ReplaceVariable };
    export { EventFilter };


    export {
        UserAccount, 
        CustomScriptManifest, 
        ScriptModules, 
        ValidParamKeys, 
        RunRequestParameters, 
        RunRequest, 
        ScriptReturnObject
    };

    export namespace Firebot {
        // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-empty-object-type
        type CustomScript<P extends Record<string, any> = {}> = {
            getScriptManifest():
                | CustomScriptManifest
                | PromiseLike<CustomScriptManifest>;
            getDefaultParameters(): ParametersConfig<P>;

            /**
             * Called at app start and when the script is added to Firebot
             */
            run(
                runRequest: RunRequest<P>
            ):
                | void
                | PromiseLike<void>
                | ScriptReturnObject
                | Promise<ScriptReturnObject>;

            /**
             * Called when the user saves script parameters
             */
            parametersUpdated?(parameters: P): void;

            /**
             * Called when the script is removed from Firebot. Use this to clean up registered effects/connections/etc
             */
            stop?(): void;
        };

        type EffectType<EffectModel> = Effects.EffectType<EffectModel>;

        type EffectList = Effects.EffectList;
    }
}